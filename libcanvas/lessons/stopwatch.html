<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<script src="js/atom.js"></script>
		<script src="js/libcanvas.js"></script>
		<script>
LibCanvas.extract();

atom.dom(function() {
	var StopWatch = atom.Class({
		Implements: [ Drawable, Draggable ],
		initialize: function (center) {
			this.center   = center;
			this.millisec = this.line();
			this.seconds  = this.line();
			this.minutes  = this.line();
			this.shape    = new Circle( center, 25 );

			center.addEvent('move', function (diff) {
				// мы вызываем метод "move" с параметром "diff" у всех точек
				[this.millisec.to, this.seconds.to, this.minutes.to].invoke('move', diff);
			}.bind(this));
		},
		// Метод для удобного создания линии
		line: function () {
			return new Line( this.center, this.center.clone().move([0, -20]) );
		},
		update: function (time) {
			var full = (360).degree();

			// Методы toSeconds, toMinutes и toHours взяты из LibCanvas.Utils.Math
			// Миллисекундная стрелка должна сделать полный оборот за секунду
			this.millisec.to.rotate( full * time.toSeconds(), this.center );
			// Секундная - за минуту
			this.seconds .to.rotate( full * time.toMinutes(), this.center );
			// Минутная - за час
			this.minutes .to.rotate( full * time.toHours()  , this.center );
			this.libcanvas.update();
		},
		draw: function () {
			this.libcanvas.ctx
				.stroke( this.shape   , '#c00' )
				.stroke( this.millisec, '#999' )
				.stroke( this.seconds , '#000' )
				.stroke( this.minutes , '#090' );
		}
	});

	var libcanvas = new LibCanvas('canvas');

	// Мы конструируем новый объект
	// Обратите внимание на запись угла. Человеку обычно привычнее считать угол в градусах
	// В программировании принято хранить угол в радианах.
	// Такая запись позволяет легко получить радианы из градусов
	var sw = new StopWatch( new Point(50, 50) );


	libcanvas
		// Очень важно не забыть "запустить" LibCanvas, он ждёт вашей команды "start"
		.start()
		// Без вызова этого метода действия с мышью - невозможны
		.listenMouse()
		.addElement( sw.draggable() )
		// обратите внимание, что если мы просто передадим "item.update", то он будет вызван
		// с неверным контекстом, потому привязываем его при помощи bind к объекту:
		.addFunc( sw.update.bind(sw) );
});
		</script>
	</head>
	<body>
		<canvas></canvas>
	</body>
</html>