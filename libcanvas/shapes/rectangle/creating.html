<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>LibCanvas :: Creating rectangles</title>
		<link href="/libcanvas/files/styles.css" rel="stylesheet" />
		<script src="/libcanvas/files/js/atom.js"></script>
		<script src="/libcanvas/files/js/libcanvas.js"></script>
	</head>
	<body>
		<canvas></canvas>
		<p><a href="/libcanvas">Return to index</a></p>
		<script src="/libcanvas/files/js/ui-core.js"></script>
		<script>
new function () {
	var canvas = atom.dom('canvas').css({ background: 'url(/libcanvas/files/img/bg.jpg)' });

	UiCore.libcanvas = new LibCanvas(canvas)
		.listenMouse()
		.size({
			width : 512,
			height: 256
		}, true);

	var libcanvas = UiCore.libcanvas;

	var cache = libcanvas.createBuffer();
	var last  = null;
	
	var closeLastRectangle = function () {
		if ( last ) {
			last.stopDrawing()
				.setOptions({
					fill   : 'rgba(192, 192, 192, 0.4)',
					stroke : 'rgba(  0,   0,   0, 0.4)'
				})
				.drawTo(cache.getContext('2d-libcanvas'));
			last = null;

			libcanvas.update();
		}
	};

	libcanvas.mouse.addEvent({
		mousedown : function () {
			var start = libcanvas.mouse.point.clone().snapToPixel();
			last = libcanvas
				.createShaper({
					shape : new LibCanvas.Shapes.Rectangle( start, start.clone() ),
					fill   : 'rgba(255, 192, 192, 0.4)',
					stroke : 'rgba(127,   0,   0, 0.4)'
				});
		},
		mouseup  : closeLastRectangle,
		mouseout : closeLastRectangle
	});

	libcanvas
		.addFunc(function () {
			if ( last && libcanvas.mouse.inCanvas ) {
				last.shape.to
					.moveTo(libcanvas.mouse.point)
					.snapToPixel();
				libcanvas.update();
			}
		})
		.start(function () {
			libcanvas.ctx.drawImage(cache);
		});
}
		</script>

	</body>
</html>